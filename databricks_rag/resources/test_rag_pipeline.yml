# The main job for test_env_setup.
resources:
  jobs:
    test_rag_pipeline:
      name: test_rag_pipeline_e2e

      tasks:
        - task_key: setup_infra_task
          notebook_task:
            notebook_path: ../src/1_setup_infra_for_rag_pipeline.py
            base_parameters:
              openai_endpoint_name: ${var.test_openai_endpoint_name}
              database: ${var.test_database}
          max_retries: 0

        - task_key: rag_ocr_task
          depends_on:
            - task_key: setup_infra_task
          notebook_task:
            notebook_path: ../src/2_ocr_pdf_and_create_text_chunks.py
            base_parameters:
              openai_endpoint_name: ${var.test_openai_endpoint_name}
              database: ${var.test_database}
          max_retries: 0
